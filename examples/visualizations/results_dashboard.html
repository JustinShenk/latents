<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporal Scale Detection - Full Results</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0e27;
            color: #e0e6ed;
            line-height: 1.6;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 30px;
        }

        header {
            text-align: center;
            padding: 50px 20px;
            background: linear-gradient(135deg, #1a1f3a 0%, #2d3561 100%);
            border-radius: 16px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 3.2em;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #a0aec0;
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .status-badge {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 20px;
            font-weight: 600;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #2d3561 100%);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            border: 2px solid #3d4571;
            transition: transform 0.2s, border-color 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: #667eea;
        }

        .stat-label {
            color: #a0aec0;
            font-size: 0.9em;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .stat-detail {
            color: #10b981;
            font-size: 0.95em;
            font-weight: 500;
        }

        .viz-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1400px) {
            .viz-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: #1a1f3a;
            border-radius: 12px;
            padding: 35px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .panel-title {
            font-size: 1.8em;
            margin-bottom: 12px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-description {
            color: #a0aec0;
            margin-bottom: 30px;
            font-size: 1em;
            line-height: 1.6;
        }

        .full-width-panel {
            grid-column: 1 / -1;
        }

        .example-box {
            background: #0f1428;
            padding: 25px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .example-label {
            color: #10b981;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
        }

        .example-text {
            color: #e0e6ed;
            line-height: 1.7;
            font-size: 1.05em;
        }

        .temporal-keyword {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3px 10px;
            border-radius: 4px;
            font-weight: 600;
            color: white;
        }

        .tooltip {
            position: absolute;
            padding: 14px 18px;
            background: rgba(26, 31, 58, 0.98);
            border: 1px solid #667eea;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.95em;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
            z-index: 1000;
        }

        .tooltip.show {
            opacity: 1;
        }

        .legend {
            display: flex;
            gap: 25px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95em;
        }

        .legend-swatch {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }

        svg {
            display: block;
        }

        .axis-label {
            font-size: 14px;
            fill: #a0aec0;
        }

        .grid-line {
            stroke: #2d3561;
            stroke-dasharray: 2,2;
            stroke-width: 1;
        }

        .info-banner {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 40px;
            text-align: center;
        }

        .info-banner-text {
            font-size: 1.2em;
            font-weight: 600;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Temporal Scale Detection in GPT-2</h1>
            <p class="subtitle">Full Experiment Results - 300 Prompt Pairs</p>
            <div class="status-badge">✓ Experiment Complete</div>
        </header>

        <div class="info-banner">
            <div class="info-banner-text">
                🎉 Peak Performance: 92.5% Accuracy on Training Set (Layer 8) | +42.5pp Above Baseline
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Training Accuracy</div>
                <div class="stat-value">92.5%</div>
                <div class="stat-detail">Layer 8 | 400 samples</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Test Accuracy</div>
                <div class="stat-value">84%</div>
                <div class="stat-detail">Layer 6 | 100 samples</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Above Baseline</div>
                <div class="stat-value">+42.5pp</div>
                <div class="stat-detail">Training set improvement</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Dataset Size</div>
                <div class="stat-value">300</div>
                <div class="stat-detail">Prompt pairs (600 samples)</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Control (Ablated)</div>
                <div class="stat-value">100%</div>
                <div class="stat-detail">Layers 10-11 perfect</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Best Layer</div>
                <div class="stat-value">L8</div>
                <div class="stat-detail">Consistent across splits</div>
            </div>
        </div>

        <div class="viz-grid">
            <!-- Training Results -->
            <div class="panel">
                <h2 class="panel-title">
                    <span>📈</span>
                    <span>Training Set Performance</span>
                </h2>
                <p class="panel-description">
                    Probe accuracy across all 12 GPT-2 layers on 400 training samples.
                    Layer 8 achieves 92.5% accuracy with low variance.
                </p>
                <div id="trainingViz"></div>
            </div>

            <!-- Test Results -->
            <div class="panel">
                <h2 class="panel-title">
                    <span>🎯</span>
                    <span>Test Set Performance</span>
                </h2>
                <p class="panel-description">
                    Generalization on held-out 100-sample test set.
                    Peak at Layer 6 (84%), showing robust temporal scale detection.
                </p>
                <div id="testViz"></div>
            </div>

            <!-- Comparison -->
            <div class="panel full-width-panel">
                <h2 class="panel-title">
                    <span>📊</span>
                    <span>Train vs Test Comparison</span>
                </h2>
                <p class="panel-description">
                    Compare performance across training and test sets. Shows strong generalization with ~8pp gap.
                    Control (keyword ablation) shows surprisingly high performance in late layers.
                </p>
                <div id="comparisonViz"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-swatch" style="background: #667eea;"></div>
                        <span>Training Set (400 samples)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-swatch" style="background: #10b981;"></div>
                        <span>Test Set (100 samples)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-swatch" style="background: #f59e0b;"></div>
                        <span>Control - Keyword Ablated</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-swatch" style="background: #ef4444; opacity: 0.3;"></div>
                        <span>Baseline (50%)</span>
                    </div>
                </div>
            </div>

            <!-- Example Prompts -->
            <div class="panel full-width-panel">
                <h2 class="panel-title">
                    <span>📝</span>
                    <span>Example Prompt Pairs</span>
                </h2>
                <p class="panel-description">
                    Real examples from the test set showing identical tasks with different temporal scales.
                </p>
                <div class="example-box">
                    <div class="example-label">Example 1: Business - Data Center</div>
                    <div class="example-text">
                        <strong>Short-term:</strong> Develop a <span class="temporal-keyword">1 week</span> plan to establishing a new data center for the organization with necessary hardware and software...<br><br>
                        <strong>Long-term:</strong> Develop a <span class="temporal-keyword">20 years</span> plan to establishing a new data center for the organization with necessary hardware and software...
                    </div>
                </div>
                <div class="example-box">
                    <div class="example-label">Example 2: Business - Marketing Strategy</div>
                    <div class="example-text">
                        <strong>Short-term:</strong> Develop a <span class="temporal-keyword">1 month</span> plan to develop a comprehensive marketing strategy, including market research, identifying target audiences...<br><br>
                        <strong>Long-term:</strong> Develop a <span class="temporal-keyword">10 years</span> plan to develop a comprehensive marketing strategy, including market research, identifying target audiences...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip"></div>

    <script>
        // Real data from full experiment
        const trainingData = [
            {layer: 0, accuracy: 0.68, std: 0.0562},
            {layer: 1, accuracy: 0.7475, std: 0.1011},
            {layer: 2, accuracy: 0.82, std: 0.0664},
            {layer: 3, accuracy: 0.8375, std: 0.1191},
            {layer: 4, accuracy: 0.875, std: 0.0661},
            {layer: 5, accuracy: 0.90, std: 0.0474},
            {layer: 6, accuracy: 0.91, std: 0.0649},
            {layer: 7, accuracy: 0.915, std: 0.0713},
            {layer: 8, accuracy: 0.925, std: 0.0637},
            {layer: 9, accuracy: 0.90, std: 0.0418},
            {layer: 10, accuracy: 0.86, std: 0.0320},
            {layer: 11, accuracy: 0.8525, std: 0.0421}
        ];

        const testData = [
            {layer: 0, accuracy: 0.72, std: 0.0678},
            {layer: 1, accuracy: 0.65, std: 0.0894},
            {layer: 2, accuracy: 0.80, std: 0.0316},
            {layer: 3, accuracy: 0.77, std: 0.0872},
            {layer: 4, accuracy: 0.81, std: 0.0490},
            {layer: 5, accuracy: 0.81, std: 0.0374},
            {layer: 6, accuracy: 0.84, std: 0.0970},
            {layer: 7, accuracy: 0.81, std: 0.1393},
            {layer: 8, accuracy: 0.81, std: 0.1158},
            {layer: 9, accuracy: 0.76, std: 0.1158},
            {layer: 10, accuracy: 0.74, std: 0.1319},
            {layer: 11, accuracy: 0.77, std: 0.1208}
        ];

        const controlData = [
            {layer: 0, accuracy: 0.64, std: 0.0663},
            {layer: 1, accuracy: 0.62, std: 0.0927},
            {layer: 2, accuracy: 0.52, std: 0.0400},
            {layer: 3, accuracy: 0.62, std: 0.0748},
            {layer: 4, accuracy: 0.72, std: 0.1030},
            {layer: 5, accuracy: 0.76, std: 0.1200},
            {layer: 6, accuracy: 0.78, std: 0.0872},
            {layer: 7, accuracy: 0.77, std: 0.0678},
            {layer: 8, accuracy: 0.91, std: 0.0970},
            {layer: 9, accuracy: 0.99, std: 0.0200},
            {layer: 10, accuracy: 1.00, std: 0.0000},
            {layer: 11, accuracy: 1.00, std: 0.0000}
        ];

        const tooltip = d3.select('.tooltip');

        function showTooltip(event, content) {
            tooltip.html(content)
                .style('left', (event.pageX + 15) + 'px')
                .style('top', (event.pageY - 15) + 'px')
                .classed('show', true);
        }

        function hideTooltip() {
            tooltip.classed('show', false);
        }

        // Training visualization
        function createBarChart(container, data, title) {
            const width = 700;
            const height = 450;
            const margin = {top: 40, right: 40, bottom: 60, left: 70};

            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const x = d3.scaleBand()
                .domain(data.map(d => d.layer))
                .range([margin.left, width - margin.right])
                .padding(0.25);

            const y = d3.scaleLinear()
                .domain([0.5, 1.0])
                .range([height - margin.bottom, margin.top]);

            const colorScale = d3.scaleSequential()
                .domain([0.5, 1.0])
                .interpolator(d3.interpolateRgbBasis(['#ef4444', '#f59e0b', '#10b981', '#3b82f6']));

            // Grid
            svg.append('g')
                .selectAll('line')
                .data(y.ticks(10))
                .join('line')
                .attr('class', 'grid-line')
                .attr('x1', margin.left)
                .attr('x2', width - margin.right)
                .attr('y1', d => y(d))
                .attr('y2', d => y(d));

            // Bars
            svg.selectAll('.bar')
                .data(data)
                .join('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.layer))
                .attr('y', d => y(d.accuracy))
                .attr('width', x.bandwidth())
                .attr('height', d => y(0.5) - y(d.accuracy))
                .attr('fill', d => colorScale(d.accuracy))
                .attr('rx', 4)
                .style('cursor', 'pointer')
                .on('mouseover', (event, d) => {
                    showTooltip(event, `
                        <strong>Layer ${d.layer}</strong><br>
                        Accuracy: ${(d.accuracy * 100).toFixed(1)}%<br>
                        Std Dev: ±${(d.std * 100).toFixed(1)}%<br>
                        95% CI: ${((d.accuracy - 1.96 * d.std) * 100).toFixed(1)}% - ${((d.accuracy + 1.96 * d.std) * 100).toFixed(1)}%
                    `);
                })
                .on('mouseout', hideTooltip);

            // Baseline
            svg.append('line')
                .attr('x1', margin.left)
                .attr('x2', width - margin.right)
                .attr('y1', y(0.5))
                .attr('y2', y(0.5))
                .attr('stroke', '#ef4444')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5');

            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .attr('fill', '#a0aec0')
                .style('font-size', '13px');

            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickFormat(d => (d * 100).toFixed(0) + '%'))
                .selectAll('text')
                .attr('fill', '#a0aec0')
                .style('font-size', '13px');

            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 15)
                .attr('text-anchor', 'middle')
                .attr('class', 'axis-label')
                .text('Layer');

            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 25)
                .attr('text-anchor', 'middle')
                .attr('class', 'axis-label')
                .text('Accuracy');
        }

        // Comparison visualization
        function createComparison() {
            const width = 1400;
            const height = 500;
            const margin = {top: 40, right: 40, bottom: 70, left: 70};

            const svg = d3.select('#comparisonViz')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const x = d3.scaleLinear()
                .domain([0, 11])
                .range([margin.left, width - margin.right]);

            const y = d3.scaleLinear()
                .domain([0.45, 1.05])
                .range([height - margin.bottom, margin.top]);

            // Grid
            svg.append('g')
                .selectAll('line')
                .data(y.ticks(12))
                .join('line')
                .attr('class', 'grid-line')
                .attr('x1', margin.left)
                .attr('x2', width - margin.right)
                .attr('y1', d => y(d))
                .attr('y2', d => y(d));

            // Lines
            const line = d3.line()
                .x(d => x(d.layer))
                .y(d => y(d.accuracy))
                .curve(d3.curveMonotoneX);

            // Training line
            svg.append('path')
                .datum(trainingData)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#667eea')
                .attr('stroke-width', 3);

            // Test line
            svg.append('path')
                .datum(testData)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#10b981')
                .attr('stroke-width', 3);

            // Control line
            svg.append('path')
                .datum(controlData)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', '#f59e0b')
                .attr('stroke-width', 3)
                .attr('stroke-dasharray', '5,5');

            // Points - Training
            svg.selectAll('.point-train')
                .data(trainingData)
                .join('circle')
                .attr('class', 'point-train')
                .attr('cx', d => x(d.layer))
                .attr('cy', d => y(d.accuracy))
                .attr('r', 6)
                .attr('fill', '#667eea')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('mouseover', (event, d) => {
                    showTooltip(event, `
                        <strong>Training - Layer ${d.layer}</strong><br>
                        Accuracy: ${(d.accuracy * 100).toFixed(1)}%
                    `);
                })
                .on('mouseout', hideTooltip);

            // Points - Test
            svg.selectAll('.point-test')
                .data(testData)
                .join('circle')
                .attr('class', 'point-test')
                .attr('cx', d => x(d.layer))
                .attr('cy', d => y(d.accuracy))
                .attr('r', 6)
                .attr('fill', '#10b981')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('mouseover', (event, d) => {
                    showTooltip(event, `
                        <strong>Test - Layer ${d.layer}</strong><br>
                        Accuracy: ${(d.accuracy * 100).toFixed(1)}%
                    `);
                })
                .on('mouseout', hideTooltip);

            // Points - Control
            svg.selectAll('.point-control')
                .data(controlData)
                .join('circle')
                .attr('class', 'point-control')
                .attr('cx', d => x(d.layer))
                .attr('cy', d => y(d.accuracy))
                .attr('r', 5)
                .attr('fill', '#f59e0b')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('mouseover', (event, d) => {
                    showTooltip(event, `
                        <strong>Control - Layer ${d.layer}</strong><br>
                        Accuracy: ${(d.accuracy * 100).toFixed(1)}%
                    `);
                })
                .on('mouseout', hideTooltip);

            // Baseline
            svg.append('line')
                .attr('x1', margin.left)
                .attr('x2', width - margin.right)
                .attr('y1', y(0.5))
                .attr('y2', y(0.5))
                .attr('stroke', '#ef4444')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5')
                .attr('opacity', 0.3);

            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x).ticks(12))
                .selectAll('text')
                .attr('fill', '#a0aec0')
                .style('font-size', '13px');

            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickFormat(d => (d * 100).toFixed(0) + '%'))
                .selectAll('text')
                .attr('fill', '#a0aec0')
                .style('font-size', '13px');

            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 20)
                .attr('text-anchor', 'middle')
                .attr('class', 'axis-label')
                .text('Layer');

            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 25)
                .attr('text-anchor', 'middle')
                .attr('class', 'axis-label')
                .text('Accuracy');
        }

        // Initialize
        createBarChart('#trainingViz', trainingData, 'Training Set');
        createBarChart('#testViz', testData, 'Test Set');
        createComparison();
    </script>
</body>
</html>
